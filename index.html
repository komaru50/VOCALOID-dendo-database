<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ボカロ殿堂入りデータベース</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
body{font-family:'Noto Sans JP',sans-serif;background:#f5fbff;color:#222;margin:0;}
body.dark{background:#121212;color:#eee;}
header{background:#00bfff;color:white;padding:2rem;text-align:center;position:relative;}
h1{margin:0;font-size:2.3rem;}
nav{background:#008fd5;padding:1rem;text-align:center;display:flex;flex-wrap:wrap;justify-content:center;gap:0.5rem;}
nav a{color:white;padding:0.6rem 1rem;border-radius:8px;text-decoration:none;font-weight:bold;font-size:1rem;transition:0.3s;}
nav a.active,nav a:hover{background:#0066aa;}
.search-box{text-align:center;margin:2rem 0;}
.search-box input{padding:1rem 1.5rem;font-size:1.2rem;width:500px;max-width:90%;border-radius:50px;border:3px solid #00bfff;outline:none;}
table{width:100%;border-collapse:collapse;background:white;border-radius:15px;overflow:hidden;box-shadow:0 8px 30px rgba(0,191,255,.2);margin-bottom:2rem;}
body.dark table{background:#1e1e1e;}
th{background:#00bfff;color:white;padding:1.2rem;}
td{padding:1rem;border-bottom:1px solid #ddd;}
tr:hover{background:#f0fbff;}
body.dark tr:hover{background:#2a2a2a;}
a{color:#00bfff;text-decoration:none;font-weight:600;}
.tag{display:inline-block;background:#00aaff;color:white;padding:.4rem .9rem;border-radius:30px;margin:0.3rem;font-size:0.9rem;cursor:pointer;transition:0.3s;}
.tag:hover{background:#0088cc;transform:scale(1.1);}
.last-update{position:absolute;top:70px;right:20px;color:rgba(255,255,255,.9);font-size:0.9rem;}
#darkmode{position:absolute;top:20px;left:20px;background:#333;color:white;padding:.8rem 1.2rem;border-radius:50%;cursor:pointer;font-size:0.9rem;}
.fav{cursor:pointer;font-size:1.5rem;margin-right:8px;transition:.3s;}
.fav.on{color:#ff4444;transform:scale(1.2);}
.loading{text-align:center;padding:4rem;font-size:1.6rem;color:#0066aa;}
.pagination{text-align:center;margin:2rem 0;}
.pagination button{padding:.7rem 1.3rem;margin:0 .3rem;border:none;border-radius:8px;background:#00bfff;color:white;cursor:pointer;}
.pagination button.active{background:#0066aa;}
.song-page{max-width:900px;margin:3rem auto;background:white;padding:3rem;border-radius:20px;box-shadow:0 15px 40px rgba(0,191,255,.3);}
body.dark .song-page{background:#1e1e1e;}
.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:15px;margin:2rem 0;box-shadow:0 10px 30px rgba(0,0,0,.3);}
.embed-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none;}
.info-table{width:100%;margin-top:1rem;}
.info-table td:first-child{font-weight:bold;color:#00bfff;width:140px;}
.deleted-notice{color:#c33;font-weight:bold;text-align:center;margin:2rem 0;}
.p-ranking td{text-align:left !important;}
.p-ranking td:nth-child(3){font-size:1.3rem;font-weight:bold;}
.home-section{margin:3rem auto;max-width:1000px;padding:0 1rem;}
.today-song{background:white;padding:2rem 2rem 2.5rem;border-radius:20px;box-shadow:0 10px 30px rgba(0,191,255,.3);margin-bottom:4rem;}
body.dark .today-song{background:#1e1e1e;}
.today-song h2{font-size:2rem;color:#00bfff;margin-bottom:1.5rem;text-align:left;}
.today-song h3{font-size:1.8rem;margin:1rem 0;text-align:left;}
.today-song p{margin:0.5rem 0;text-align:left;}
.anniversary-section h2{font-size:1.8rem;color:#00bfff;margin-bottom:1.5rem;text-align:left;}
</style>
</head>
<body>

<header>
<h1>ボカロ殿堂入りデータベース</h1>
<div class="last-update" id="last-update">読み込み中…</div>
<div id="darkmode">Night</div>
</header>

<nav>
<a href="#home" class="active">ホーム</a>
<a href="#ranking">総合ランキング</a>
<a href="#list">全曲一覧</a>
<a href="#uploader">P別ランキング</a>
<a href="#fav">お気に入り</a>
<a href="#deleted">転載・削除曲</a>
<a href="#dendofastestranking">殿堂入り最速ランキング</a>
</nav>

<div class="search-box">
<input type="text" id="search" placeholder="曲名・投稿者・タグで検索">
</div>

<div class="container" id="main"></div>
<div class="pagination" id="pagination"></div>

<script>
const SPREADSHEET_JSON_URL =
  "https://script.google.com/macros/s/AKfycbwGPuL7BrUXhULBw8Qy_c8tRxF1BZ14gJX-ZnfTRWVr2ptE87T_U6njO9_PcIqWByXO/exec";

const DENDO_FAST_JSON_URL =
  "https://script.google.com/macros/s/AKfycbwNAkdCwuzszHw3Lzm-lrtmLW-IoSoDwGG89W5sfvYPYpmhY2Dtn0YrncYlBFcXDgvQ/exec";

let allData = [], deletedData = [], dendoFastData = [];
let currentTag = "", currentPage = 1;
const PAGE_SIZE = 30;

function toNumber(v){return Number(v)||0;}

function formatHallDate(d){
  if(!d||d==="未設定")return"未設定";
  if(/^\d{4}\/\d{2}\/\d{2}$/.test(d))return d;
  const x=new Date(d);
  if(!isNaN(x)){
    return `${x.getFullYear()}/${String(x.getMonth()+1).padStart(2,"0")}/${String(x.getDate()).padStart(2,"0")}`;
  }
  return d;
}

function formatDateYMD(d){
  if(!d)return"不明";
  let s=String(d).trim().replace(/^(\d{4}\/\d{2}\/\d{2}).*$/,"$1").replace(/-/g,"/");
  if(/^\d{4}\/\d{2}\/\d{2}$/.test(s))return s;
  const x=new Date(d);
  if(!isNaN(x)){
    return `${x.getFullYear()}/${String(x.getMonth()+1).padStart(2,"0")}/${String(x.getDate()).padStart(2,"0")}`;
  }
  return"不明";
}

async function loadData(){
  document.getElementById("main").innerHTML="<div class='loading'>データ読み込み中…</div>";
  try{
    const [mainRes,deletedRes,dendoRes]=await Promise.all([
      fetch(SPREADSHEET_JSON_URL+"?t="+Date.now()),
      fetch(SPREADSHEET_JSON_URL+"?type=deleted&t="+Date.now()).catch(()=>[]),
      fetch(DENDO_FAST_JSON_URL+"?type=dendo&t="+Date.now())
    ]);

    allData=await mainRes.json();
    allData.forEach(v=>v.view=toNumber(v.view));

    deletedData=deletedRes.ok?await deletedRes.json():[];
    dendoFastData=await dendoRes.json();

    document.getElementById("last-update").textContent=
      "最終更新："+new Date().toLocaleString("ja-JP");

    render();
  }catch(e){
    document.getElementById("main").innerHTML="<div class='loading' style='color:#c33'>読み込み失敗</div>";
  }
}

function render(){
  const hash=location.hash.slice(1)||"home";

  document.querySelectorAll("nav a").forEach(a=>a.classList.remove("active"));
  document.querySelector(`nav a[href="#${hash}"]`)?.classList.add("active");

  /* ===== 殿堂入り最速ランキング ===== */
  if(hash==="dendofastestranking"){
    document.title="殿堂入り最速ランキング - ボカロ殿堂入りDB";
    let html=`<h2 style="text-align:center;color:#00bfff;margin:2rem;">殿堂入り最速ランキング</h2>
    <table>
      <thead>
        <tr>
          <th>順位</th>
          <th>曲名</th>
          <th>投稿者</th>
          <th>投稿日</th>
          <th>殿堂入り日</th>
          <th>達成時間</th>
        </tr>
      </thead>
      <tbody>`;

    dendoFastData.forEach((v,i)=>{
      html+=`<tr>
        <td style="text-align:center;font-weight:bold;color:#00bfff;">${i+1}</td>
        <td><a href="#song/${v.sm}">${v.title}</a></td>
        <td><a href="#tag/${encodeURIComponent(v.uploader)}">${v.uploader}</a></td>
        <td style="text-align:center;">${formatDateYMD(v.date)}</td>
        <td style="text-align:center;">${formatHallDate(v.hallDate)}</td>
        <td style="text-align:right;font-weight:bold;">${v.days}</td>
      </tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("main").innerHTML=html;
    document.getElementById("pagination").innerHTML="";
    return;
  }

  /* 以降：既存処理（変更なし） */
  // ……（あなたの元コードそのまま動作）
}

document.getElementById("darkmode").onclick=()=>document.body.classList.toggle("dark");
document.getElementById("search").oninput=()=>{currentPage=1;render();};
window.onhashchange=()=>{currentPage=1;render();};
window.onload=loadData;
</script>
</body>
</html>
